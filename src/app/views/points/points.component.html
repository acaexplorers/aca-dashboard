<div class="points-container">
  <h2>Weekly Points Report</h2>
  <!-- Date Picker for Week Selection -->
   
  <div class="search-container">
    <mat-form-field appearance="fill" class="search-field">
      <mat-label>Search by student name</mat-label>
      <input matInput [(ngModel)]="searchTerm" (keyup.enter)="applyFilter()">
      <button matSuffix mat-button (click)="applyFilter()">
        <span class="search-icon">üîç</span>
      </button>
    </mat-form-field>
  </div>

  <div class="date-selection-container">
    <mat-form-field class="date-input-start">
      <mat-label>Select Week Starting Day</mat-label>
      <input matInput [matDatepicker]="startPicker"
             (dateChange)="onChangeWeekStart($event.value)"
             [matDatepickerFilter]="startDateFilter"
             [value]="selectedWeek">
      <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
      <mat-datepicker #startPicker></mat-datepicker>
      <mat-hint>Must be a Wednesday</mat-hint>
    </mat-form-field>

    <mat-form-field class="date-input-end">
      <mat-label>Select Week Ending Day</mat-label>
      <input
        matInput
        [matDatepicker]="endPicker"
        (dateChange)="onChangeWeekEnd($event.value)"
        [matDatepickerFilter]="endDateFilter"
        [min]="minEndDate"
      />
      <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
      <mat-datepicker #endPicker></mat-datepicker>
      <mat-hint>Must be a Tuesday</mat-hint>
    </mat-form-field>

      <!-- Bot√≥n de b√∫squeda -->
    <button mat-flat-button color="primary" 
            (click)="fetchCombinedData()" 
            class="search-button"
            [disabled]="isLoading">
      <span *ngIf="!isLoading">Search</span>
      <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
    </button>
  </div>


  <!-- Data Table -->
  <div class="table-responsive">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
      
      <!-- Student Column -->
      <ng-container matColumnDef="student">
        <th mat-header-cell *matHeaderCellDef>Student</th>
        <td mat-cell *matCellDef="let item">{{ item.student || 'N/A' }}</td>
      </ng-container>

      <!-- Points Column -->
      <ng-container matColumnDef="points">
        <th mat-header-cell *matHeaderCellDef>Points</th>
        <td mat-cell *matCellDef="let item">{{ item.points || 0 | number }}</td>
      </ng-container>

      <!-- Total Points Column -->
      <ng-container matColumnDef="totalPoints">
        <th mat-header-cell *matHeaderCellDef>Total Points</th>
        <td mat-cell *matCellDef="let item">{{ item.totalPoints || 0 | number }}</td>
      </ng-container>

      <!-- Added Column -->
      <ng-container matColumnDef="added">
        <th mat-header-cell *matHeaderCellDef>Added</th>
        <td mat-cell *matCellDef="let item">{{ item.added || 0 }}</td>
      </ng-container>

      <!-- Study Rate Column -->
      <ng-container matColumnDef="studyRate">
        <th mat-header-cell *matHeaderCellDef>Study Rate</th>
        <td mat-cell *matCellDef="let item">{{ item.studyRate || 0 | number:'1.2-2' }}</td>
      </ng-container>

      <!-- Days Studied Column -->
      <ng-container matColumnDef="daysStudied">
        <th mat-header-cell *matHeaderCellDef>Days Studied</th>
        <td mat-cell *matCellDef="let item">{{ item.daysStudied || 0 }}</td>
      </ng-container>

      <!-- Streak Column -->
      <ng-container matColumnDef="streak">
        <th mat-header-cell *matHeaderCellDef>Streak</th>
        <td mat-cell *matCellDef="let item">{{ item.streak || 0 }}</td>
      </ng-container>

      <!-- Studied Column -->
      <ng-container matColumnDef="studied">
        <th mat-header-cell *matHeaderCellDef>Studied</th>
        <td mat-cell *matCellDef="let item">{{ item.studied || 0 }}</td>
      </ng-container>

      <!-- Max Level Column -->
      <ng-container matColumnDef="maxLevel">
        <th mat-header-cell *matHeaderCellDef>Max Level</th>
        <td mat-cell *matCellDef="let item">{{ item.maxLevel || 0 }}</td>
      </ng-container>

      <!-- Active Days Column -->
      <ng-container matColumnDef="activeDays">
        <th mat-header-cell *matHeaderCellDef>Active Days</th>
        <td mat-cell *matCellDef="let item">{{ item.activeDays || 0 }}</td>
      </ng-container>

      <!-- Added Streak Column -->
      <ng-container matColumnDef="addedStreak">
        <th mat-header-cell *matHeaderCellDef>Added Streak</th>
        <td mat-cell *matCellDef="let item">{{ item.addedStreak || 0 }}</td>
      </ng-container>

      <!-- Active Streak Column -->
      <ng-container matColumnDef="activeStreak">
        <th mat-header-cell *matHeaderCellDef>Active Streak</th>
        <td mat-cell *matCellDef="let item">{{ item.activeStreak || 0 }}</td>
      </ng-container>

      <!-- Active Days Streak Column -->
      <ng-container matColumnDef="activeDaysStreak">
        <th mat-header-cell *matHeaderCellDef>Active Days Streak</th>
        <td mat-cell *matCellDef="let item">{{ item.activeDaysStreak || 0 }}</td>
      </ng-container>

      <!-- Action Column -->
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>Action</th>
        <td mat-cell *matCellDef="let item">
          <button mat-button class="generate-button" 
                  (click)="generateReport(item)"
                  [disabled]="isLoading">
            GENERATE
          </button>
        </td>
      </ng-container>

      <!-- Header Row -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

    <!-- Data Row -->
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    <!-- Row cuando no hay datos -->
    <tr *matNoDataRow>
      <td [attr.colspan]="displayedColumns.length" class="no-data-row">
        No se encontraron datos
      </td>
    </tr>
  </table>

    
  <!-- Pagination Controls -->
  <!-- <div class="pagination-wrapper">
    <mat-form-field appearance="fill" class="page-size-selector">
      <mat-label>Items per page</mat-label>
      <mat-select [(value)]="pageSize" (selectionChange)="onPageSizeChange($event)">
        <mat-option *ngFor="let size of [10, 20, 50, 100]" [value]="size">
          {{ size }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <div class="pagination-container">
      <div class="page-info">
        Showing {{ (currentPage - 1) * pageSize + 1 }}-{{ Math.min(currentPage * pageSize, totalItems) }} of {{ totalItems }} items
      </div>
    
      <div class="pagination-controls">
        <button mat-button (click)="goToPage(1)" [disabled]="currentPage === 1">
          &lt;&lt;
        </button>
        <button mat-button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
          &lt;
        </button>
    
        <ng-container *ngIf="totalPages <= 5">
          <button mat-button *ngFor="let page of totalPagesArray" 
                  (click)="goToPage(page)"
                  [color]="page === currentPage ? 'primary' : ''">
            {{ page }}
          </button>
        </ng-container>
    
        <ng-container *ngIf="totalPages > 5">
          <button mat-button *ngIf="currentPage > 3" (click)="goToPage(1)">1</button>
          <span *ngIf="currentPage > 4">...</span>
    
          <button mat-button *ngFor="let page of getMiddlePages()" 
                  (click)="goToPage(page)"
                  [color]="page === currentPage ? 'primary' : ''">
            {{ page }}
          </button>
    
          <span *ngIf="currentPage < totalPages - 3">...</span>
          <button mat-button *ngIf="currentPage < totalPages - 2" (click)="goToPage(totalPages)">
            {{ totalPages }}
          </button>
        </ng-container>
    
        <button mat-button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
          &gt;
        </button>
        <button mat-button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">
          &gt;&gt;
        </button>
      </div>
    </div>
  </div>--->
</div>